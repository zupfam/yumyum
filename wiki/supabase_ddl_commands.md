### Final Set of Complete DDL Commands for Supabase

These commands define the schema across your primary and vendor-specific Supabase projects, incorporating the
multi-account strategy and Row Level Security (RLS) policies.

```sql
-- Create ENUM types first (These should be created once in each Supabase project where they are used)
CREATE TYPE instock_status AS ENUM ('yes', 'no', 'hide');
CREATE TYPE dietary_info AS ENUM ('veg', 'non-veg');
CREATE TYPE status_item_type AS ENUM ('image', 'video', 'text');

-----------------------------------------------------------------
-- DDL for the PRIMARY Supabase project
-----------------------------------------------------------------

-- This table maps a vendor to their dedicated Supabase project and Cloudinary account.
-- It serves as the central directory for all vendors, whether on Supabase or Google Sheets.
CREATE TABLE public.vendor_mappings
(
    id                    bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    vendor_slug           text                     NOT NULL UNIQUE, -- The unique, public-facing identifier for the vendor
    backend_type          text                     NOT NULL,        -- 'supabase' or 'gsheets'
    supabase_project_id   text,                                     -- The project ID of the dedicated Supabase project for this vendor (if backend_type is 'supabase')
    gsheet_id             text,                                     -- The Google Sheet ID for this vendor (if backend_type is 'gsheets')
    cloudinary_account_id text                     NOT NULL,        -- Identifier for the Cloudinary account (e.g., 'cld_acc_1', 'cld_acc_2')
    created_at            timestamp with time zone NOT NULL DEFAULT now()
);

-- Row Level Security (RLS) policies for the 'vendor_mappings' table
ALTER TABLE public.vendor_mappings ENABLE ROW LEVEL SECURITY;

-- Allow read access for all authenticated users (e.g., the main application fetching vendor config)
CREATE
POLICY "Enable read access for all authenticated users" ON public.vendor_mappings FOR
SELECT USING (auth.role() = 'authenticated');
-- Add policies for INSERT, UPDATE, DELETE as needed, likely restricted to admin roles or specific functions.
-- Example (restrict to service role or specific function):
-- CREATE POLICY "Allow admin to insert vendor mappings" ON public.vendor_mappings FOR INSERT WITH CHECK (auth.role() = 'service_role');
-- CREATE POLICY "Allow admin to update vendor mappings" ON public.vendor_mappings FOR UPDATE USING (auth.role() = 'service_role');
-- CREATE POLICY "Allow admin to delete vendor mappings" ON public.vendor_mappings FOR DELETE USING (auth.role() = 'service_role');

-----------------------------------------------------------------
-- DDL for EACH of the VENDOR Supabase projects (e.g., 4 separate projects)
-----------------------------------------------------------------

-- Stores the vendor's brand profile information.
CREATE TABLE public.brand
(
    id            bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    vendor_id     uuid                     NOT NULL REFERENCES auth.users (id), -- Links to Supabase Auth user ID (owner of this brand)
    vendor_slug   text                     NOT NULL UNIQUE,                     -- The public-facing slug for this vendor, for direct lookup
    name          text                     NOT NULL,
    logo_url      text                     NOT NULL,
    cuisine       text                     NOT NULL,
    description   text,
    payment_link  text,
    whatsapp      text,
    contact       text,
    location_link text,
    review_link   text,
    instagram     text,
    facebook      text,
    youtube       text,
    custom        text,
    full_menu_pic text,
    created_at    timestamp with time zone NOT NULL DEFAULT now()
);

-- RLS policies for the 'brand' table
ALTER TABLE public.brand ENABLE ROW LEVEL SECURITY;
CREATE
POLICY "Vendors can view their own brand" ON public.brand FOR
SELECT USING (auth.uid() = vendor_id);
CREATE
POLICY "Vendors can insert their own brand" ON public.brand FOR INSERT WITH CHECK (auth.uid() = vendor_id);
CREATE
POLICY "Vendors can update their own brand" ON public.brand FOR
UPDATE USING (auth.uid() = vendor_id);
CREATE
POLICY "Vendors can delete their own brand" ON public.brand FOR DELETE
USING (auth.uid() = vendor_id);


-- Stores the individual menu items for a vendor.
CREATE TABLE public.dishes
(
    id          bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    vendor_id   uuid                     NOT NULL REFERENCES auth.users (id), -- Links to Supabase Auth user ID (owner of this dish)
    category    text                     NOT NULL,
    name        text                     NOT NULL,
    description text,
    price       real,
    instock     instock_status                    DEFAULT 'yes',              -- Use ENUM type
    veg         dietary_info             NOT NULL,                            -- Use ENUM type
    tag         text,                                                         -- Using TEXT type for tag as per v3 schema in docs/architecture/9-database-schema.md
    image       text,
    reel        text,
    created_at  timestamp with time zone NOT NULL DEFAULT now()
);

-- RLS policies for the 'dishes' table
ALTER TABLE public.dishes ENABLE ROW LEVEL SECURITY;
CREATE
POLICY "Vendors can view their own dishes" ON public.dishes FOR
SELECT USING (auth.uid() = vendor_id);
CREATE
POLICY "Vendors can insert their own dishes" ON public.dishes FOR INSERT WITH CHECK (auth.uid() = vendor_id);
CREATE
POLICY "Vendors can update their own dishes" ON public.dishes FOR
UPDATE USING (auth.uid() = vendor_id);
CREATE
POLICY "Vendors can delete their own dishes" ON public.dishes FOR DELETE
USING (auth.uid() = vendor_id);


-- Stores daily status updates from the vendor.
CREATE TABLE public.status
(
    id         bigint GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    vendor_id  uuid                     NOT NULL REFERENCES auth.users (id), -- Links to Supabase Auth user ID (owner of this status)
    content    text                     NOT NULL,
    type       status_item_type         NOT NULL,                            -- Use ENUM type
    created_at timestamp with time zone NOT NULL DEFAULT now()
);

-- RLS policies for the 'status' table
ALTER TABLE public.status ENABLE ROW LEVEL SECURITY;
CREATE
POLICY "Vendors can view their own status" ON public.status FOR
SELECT USING (auth.uid() = vendor_id);
CREATE
POLICY "Vendors can insert their own status" ON public.status FOR INSERT WITH CHECK (auth.uid() = vendor_id);
CREATE
POLICY "Vendors can update their own status" ON public.status FOR
UPDATE USING (auth.uid() = vendor_id);
CREATE
POLICY "Vendors can delete their own status" ON public.status FOR DELETE
USING (auth.uid() = vendor_id);
```